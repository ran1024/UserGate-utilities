<h3>Экспорт/импорт конфигурации UTM UserGate (Версия 2.16)</h3>

Программа предназначена для переноса конфигурации с UTM версии 5 на версию 6 или между UTM 6-ой версии.

При экспорте создаются файлы в формате json с конфигурацией разделов.
Можно экспортировать настройки, затем внести необходимые изменения. Затем импортировать изменённые файлы конфигурации.

<p align="center"><img src="main_image.png"></p>

Скачать архив <b>ug_convert_config.zip</b>, распаковать, файл <b>ug_convert_config</b> сделать исполняемым.<br>
Запустить <b>ug_convert_config</b> в терминале.<br>
Программа работает в Ubuntu версии 20.04 LTS или выше.<br>
<b>Обращаем ваше внимание:</b> если вы запускаете данную программу в Ubuntu более старой версии или в другой
разновидности Linux, вы делаете это на свой страх и риск. Компания UserGate в этом случае ничем вам не может помочь.

Программа Запрашивает ip узла, login и пароль администратора UTM.

Для работы программы на интерфейсе Management в версии 5 необходимо включить сервис xml-rpc. На версии 6 этого
делать не надо, так как сервис xml-rpc на интерфейсе Management включён по умолчанию.
1. Открыть веб-консоль администратора таким образом: https://<usergate_ip>:8001/?features=zone-xml-rpc
2. В настройках нужной зоны активировать сервис "XML-RPC для управления".

Проверьте, что у администратора, логин которого используете, в профиле включены разрешения для API. 

Для полноценного переноса конфигурации (с сервисами, списками UsrGate, морфологией и другими разделами библиотеки)
необходимо перед началом работы на новой версии настроить DNS, интерфейс Untrusted (для выхода в интернет), шлюз,
произвести активацию корректным ПИН-кодом. После этого дождаться обновления библиотек и списков.<br>
Если у Вас в правилах используются доменные пользователи и группы, то при импорте необходимо в первую очередь
импортировать настройки DNS, затем список серверов авторизации LDAP. После этого ввести пароль в LDAP-коннекторе,
загрузить keytab-файл, если используется авторизация kerberos и проверить его работу. Затем можно выбрать "Импортировать всё".

<b>Примечания:</b>
1. Экспорт из правил и импорт доменных пользователей и групп в правила возможен только при использовании версии
UTM равной 5.0.6.4973 или выше, если экспорт производится из 5-ой версии и 6.1.3.10697 или выше для импорта и
экспорта. Если у вас версия 4825, поставьте update до версии 4973, который можно запросить в техподдержке UG.
<b>Не используйте версию 4973 для работы в боевом режиме. Она предназначена только для экспорта конфигурации и
последующего немедленного перехода на версию 6.</b>
2. Импорт доменных администраторов и доменных групп администраторов возможен только при использовании версии UTM 6.1.4.11000
или выше для импорта. 
3. Если вы делаете импорт не всей конфигурации, то необходимо учитывать, что разделы конфигурации взаимосвязаны друг
с другом. Поэтому импорт определённого пункта меню пройдёт без ошибок только если ранее был выполнен импорт
всех предыдущих пунктов этого меню и всех пунктов вышележащих меню.
4. После импорта профилей администраторов, необходимо проверить доступ к разделам, так как в версии 6 были добавлены
новые разделы. При импорте доступ к разделам не меняется и, следовательно, доступ к новым разделам не предоставляется.
5. Если существуют правила МЭ с одинаковыми именами, то при конвертации к имени такого правило добавляется номер,
что бы имена были уникальными.
6. Пробелы в начале и конце имён правил, списков и т.д. при конвертации удаляются.
7. Имена списков IP-адресов типа "10.10.10.0/24" заменяются на "10.10.10.0_24" так как при переносе каждый список
записывается в отдельный файл с данным именем, а в файловой системе Linux прямой слэш является разделителем пути к файлу.
8. После импорта настроек BGP в свойсвах каждого из bgp-соседей надо заново ввести пароль.
9. При импорте интерфейсов им прописываются IP-адреса из сохранённой конфигурации. Необходимо проследить, чтобы не было
конфликта IP-адресов. В общем случае можно в файле выгруженной конфигурации data/network/config_interfaces.json поменять
ip-адрес на каждом интерфейсе.
10. Раздел Библиотеки "Профили СОВ": не импортируются сигнатуры профилей СОВ с версии 5 на версию 6, так как
в 6-ой версии структура и состав сигнатур кардинально поменялись.
11. Сертификаты не переносятся. Если используется сертификат по умолчанию для SSL инспектирования (CA Default), то необходимо
обновить его у всех пользователей. Если вы используете собственные сертификаты, необходимо загрузить и сконфигурировать их заново.
12. Правила экспорта настроек на сервера FTP, SSH не переносятся. Это надо сделать руками.

09.02.2022  Исправлен экспорт правил NAT.<br>
02.02.2022  Исправлена обработка ошибок xmlrpc.<br>
27.01.2022  Исправлена ошибка при обработке IP-листов с пробелами в названии.<br>
28.12.2021  Добавлен расширенный вывод сообщений при импорте списков URL.<br>
08.12.2021  Исправлена ошибка обращения к неактивному LDAP-коннектору.<br>
07.12.2021  Сделана обработка ситуации, когда в правилах указан несуществующий сертификат.<br>
03.12.2021  Имена доменов AD сделаны нечувствительными к регистру.<br>
24.11.2021  Сделана обработка ситуации при импорте, когда списки обновляются через url.<br>
23.11.2021  Исправлен экспорт интерфейсов, если есть слоты расширения везде в разделе "Сеть".<br>
22.11.2021  Исправлен экспорт интерфейсов, если есть слоты расширения.<br>
16.11.2021  Исправлены ошибки, появляющиеся при экспорте экзотических конфигураций в некоторых случаях.<br>
12.11.2021  Исправлен импорт доменных администраторов UTM.<br>
11.11.2021  Добавлен экспорт/импорт изменённых категорий URL из раздела "Библиотеки".<br>
09.11.2021  Исправлен импорт балансировщиков ICAP.<br>
09.11.2021  Исправлен импорт настроек веб-портала.<br>
02.11.2021  Сделана обработка ошибки несуществующей зоны на выключенном интерфейсе.<br>
29.10.2021  Исправлена ошибка получения списка сертификатов.<br>
29.10.2021  Сделана обработка отсутствия прав на чтение раздела конфигурации.<br>
21.10.2021  Исправлена ошибка при экспорте доменных групп.<br>
15.10.2021  Улучшена поддержка сессии к UTM.<br>
15.10.2021  Сделаны проверки на добавление интерфейсов с несуществующими сетевыми адаптерами.<br>
15.10.2021  Исправлена ошибки при импорте зон, веб-портала и интерфейсов.<br>
13.10.2021  Доработан выход из программы. Теперь после отработки задания не происходит отключение от UTM и можно продолжать работу.<br>
14.09.2021  Добавлен экспорт/импорт правил оповещений и SNMP из раздела "Диагностика и мониторинг/Оповещения".<br>
13.09.2021  Добавлен экспорт/импорт настроек OSPF, BGP из раздела "Сеть".<br>
07.09.2021  Добавлен экспорт/импорт списка "Маршруты" из раздела "Сеть".<br>
07.09.2021  Исправлена выгрузка очень большого количества разных списков.<br>
02.09.2021  Добавлен экспорт/импорт списка "WCCP" из раздела "Сеть".<br>
02.09.2021  Исправлена выгрузка списка IP-адресов, содержащих "/" в имени списка.<br>
30.08.2021  Исправлена выгрузка сервисов раздела библиотеки.<br>
30.08.2021  Добавлен импорт интерфейсов bridge, pppoe, vlan, tunnel, vpn из раздела "Сеть".<br>
27.08.2021  Добавлен update сетевых адаптеров и импорт bond интерфейсов из раздела "Сеть".<br>
25.08.2021  Добавлен Экспорт списка "Интерфейсы" из раздела "Сеть".<br>
24.08.2021  Добавлен Экспорт/импорт списка "Шлюзы" из раздела "Сеть".<br>
24.08.2021  Добавлен Экспорт/импорт настроек "Проверка сети" из раздела "Сеть/Шлюзы".<br>
23.08.2021  Добавлен Экспорт/импорт списка администраторов UTM из раздела "UserGate/Администраторы".<br>
20.08.2021  Добавлен Экспорт/импорт настроек Веб-портала из раздела "UserGate/Настройки".<br>
20.08.2021  Добавлен Экспорт/импорт настроек паролей администраторов из раздела "UserGate/Администраторы".<br>
19.08.2021  Добавлен Экспорт/импорт списка "Серверные правила" из раздела "VPN".<br>
19.08.2021  Добавлен Экспорт/импорт списка "Клиентские правила" из раздела "VPN".<br>
19.08.2021  Добавлен Экспорт/импорт настроек интерфейса веб-консоли из раздела "UserGate/Настройки".<br>
19.08.2021  Добавлен Экспорт/импорт списка "Профили администраторов" из раздела "UserGate/Администраторы".<br>
18.08.2021  Добавлен Экспорт/импорт списка "Профили безопасности VPN" из раздела "VPN".<br>
18.08.2021  Добавлен Экспорт/импорт списка "Сети VPN" из раздела "VPN".<br>
17.08.2021  Добавлен Экспорт/импорт списка "Веб-портал" из раздела "Глобальный портал".<br>
17.08.2021  Добавлен Экспорт/импорт списка "Серверы reverse-прокси" из раздела "Глобальный портал".<br>
17.08.2021  Добавлен Экспорт/импорт списка "Правила reverse-прокси" из раздела "Глобальный портал".<br>
16.08.2021  Добавлен Экспорт/импорт списка "Профили DoS" из раздела "Политики безопасности".<br>
16.08.2021  Добавлен Экспорт/импорт списка "Правила защиты DoS" из раздела "Политики безопасности".<br>
12.08.2021  Добавлен Экспорт/импорт правил "СОВ" из раздела "Политики безопасности".<br>
12.08.2021  Добавлен Экспорт/импорт списка "Правила АСУ ТП" из раздела "Политики безопасности".<br>
13.08.2021  Добавлен Экспорт/импорт правил "Защита почтового трафика" из раздела "Политики безопасности".<br>
11.08.2021  Добавлен Экспорт/импорт правил "Веб-безопасность" из раздела "Политики безопасности".<br>
11.08.2021  Добавлен Экспорт/импорт правил "Инспектирование SSL" из раздела "Политики безопасности".<br>
11.08.2021  Добавлен Экспорт/импорт правил "Инспектирование SSH" из раздела "Политики безопасности".<br>
10.08.2021  Добавлен Экспорт/импорт правил "Фильтрация контента" из раздела "Политики безопасности".<br>
06.08.2021  Добавлен Экспорт/импорт списка "ICAP-серверы" из раздела "Политики безопасности".<br>
06.08.2021  Добавлен Экспорт/импорт списка "ICAP-правила" из раздела "Политики безопасности".<br>
09.08.2021  Добавлен Экспорт/импорт списка "Пропускная способность" из раздела "Политики сети".<br>
05.08.2021  Добавлен Экспорт/импорт правил "Балансировка нагрузки" из раздела "Политики сети".<br>
04.08.2021  Добавлен Экспорт/импорт правил "NAT и маршрутизация" из раздела "Политики сети".<br>
30.07.2021  Добавлен Экспорт/импорт Сценариев из раздела "Политики безопасности".<br>
30.07.2021  Добавлен Экспорт/импорт правил межсетевого экрана из раздела "Политики сети".<br>
27.07.2021  Добавлен Экспорт/импорт Политик BYOD из раздела "Пользователи и устройства".<br>
26.07.2021  Добавлен импорт доменных пользователей в локальные группы (при экспорте из 6-ой версии).<br>
20.07.2021  Добавлен экспорт/импорт правил Captive-портала из раздела "Пользователи и устройства".<br>
16.07.2021  Добавлен экспорт/импорт Captive-профилей из раздела "Пользователи и устройства".<br>
16.07.2021  Переделан импорт DHCP.<br>
15.07.2021  Добавлен экспорт/импорт профилей авторизации из раздела "Пользователи и устройства".<br>
14.07.2021  Добавлен экспорт/импорт профилей MFA из раздела "Пользователи и устройства".<br>
13.07.2021  Добавлен экспорт/импорт серверов авторизации из раздела "Пользователи и устройства".<br>
12.07.2021  Добавлен экспорт/импорт настроек DNS из раздела "Сеть".<br>
07.07.2021  Добавлен экспорт/импорт настроек NTP, модулей, кеширования HTTP из раздела "Настройки".<br>
06.07.2021  Добавлен экспорт/импорт локальных пользователей и групп.<br>
